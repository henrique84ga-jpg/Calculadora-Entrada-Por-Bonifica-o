<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculadora Comercial Completa</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
/* ================= ESTILOS GERAIS ================= */
:root {
    --primary: #2563eb;
    --primary-dark: #1e40af;
    --success: #16a34a;
    --warning: #ca8a04;
    --danger: #dc2626;
    --bg-page: #f8fafc;
    --bg-card: #ffffff;
    --text-main: #1e293b;
    --text-muted: #64748b;
    --border: #e2e8f0;
}

body {
    font-family: 'Inter', sans-serif;
    background: var(--bg-page);
    color: var(--text-main);
    padding: 0;
    margin: 0;
}

.container {
    max-width: 1200px;
    margin: 20px auto;
    padding: 0 15px;
}

/* ================= NAVEGA√á√ÉO SUPERIOR ================= */
.nav-top {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-bottom: 30px;
    background: #fff;
    padding: 15px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.btn-nav {
    padding: 12px 24px;
    border: 2px solid var(--border);
    background: transparent;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    font-size: 1rem;
    color: var(--text-muted);
    transition: all 0.2s;
}

.btn-nav:hover {
    border-color: var(--primary);
    color: var(--primary);
}

.btn-nav.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
    box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
}

/* Esconde as se√ß√µes que n√£o est√£o ativas */
.view-section {
    display: none;
    animation: fadeIn 0.3s ease-in-out;
}
.view-section.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* ================= ESTILOS COMUNS (INPUTS) ================= */
input, select {
    width: 100%;
    padding: 12px;
    margin-top: 5px;
    border: 1px solid #cbd5e1;
    border-radius: 8px;
    font-size: 1rem;
    box-sizing: border-box;
    font-family: inherit;
}
input:focus, select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}
label {
    font-weight: 600;
    margin-bottom: 6px;
    display: block;
    color: var(--text-main);
    font-size: 0.9rem;
}

/* ================= ESTILOS ESPEC√çFICOS DA VERS√ÉO SIMPLES ================= */
.box-simples {
    max-width: 600px;
    background: var(--bg-card);
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    margin: auto;
}
.header-simples {
    text-align: center;
    border-bottom: 1px solid var(--border);
    padding-bottom: 15px;
    margin-bottom: 20px;
}
.linha {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px dashed #eee;
    font-size: 0.95rem;
}
.destaque-valor { font-weight: bold; }
.resultado-box {
    margin-top: 20px;
    padding: 15px;
    border-radius: 8px;
    text-align: center;
    font-weight: bold;
    font-size: 1.1rem;
}
.resumo-financeiro {
    background-color: #f8fafc;
    padding: 15px;
    border-radius: 8px;
    margin-top: 20px;
    border: 1px solid var(--border);
}
.alerta {
    margin-top: 20px;
    padding: 15px;
    border-left: 5px solid var(--primary);
    background: #eff6ff;
    border-radius: 4px;
    font-size: 0.9rem;
}

/* ================= ESTILOS ESPEC√çFICOS DA VERS√ÉO AVAN√áADA ================= */
.grid-comparativo {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}
@media (max-width: 768px) { .grid-comparativo { grid-template-columns: 1fr; } }

.card-cenario {
    background: var(--bg-card);
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    overflow: hidden;
    border: 1px solid var(--border);
}
.card-header {
    background: #f1f5f9;
    padding: 15px;
    font-weight: 700;
    text-align: center;
    color: var(--primary-dark);
    border-bottom: 1px solid var(--border);
}
.card-body { padding: 20px; }
.kpi-row {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 10px;
    margin-bottom: 20px;
}
.kpi-card {
    background: #f8fafc;
    padding: 10px;
    border-radius: 8px;
    text-align: center;
    border: 1px solid var(--border);
}
.kpi-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; }
.kpi-value { font-size: 1.1rem; font-weight: 800; }
.lucro-positivo .kpi-value { color: var(--success); }
.lucro-negativo .kpi-value { color: var(--danger); }
.chart-container {
    display: flex; align-items: center; justify-content: center; gap: 20px; margin-top: 20px;
}
.donut-chart {
    width: 100px; height: 100px; border-radius: 50%;
    position: relative;
    /* Background definido via JS */
}
.donut-chart::after {
    content: ""; position: absolute; width: 60px; height: 60px;
    background: var(--bg-card); border-radius: 50%;
    top: 50%; left: 50%; transform: translate(-50%, -50%);
}
.toggle-mode {
    display: flex; align-items: center; justify-content: center; gap: 10px;
    margin-bottom: 20px; font-weight: 600;
}
/* Switch Slider */
.switch { position: relative; display: inline-block; width: 50px; height: 26px; }
.switch input { opacity: 0; width: 0; height: 0; }
.slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
.slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
input:checked + .slider { background-color: var(--primary); }
input:checked + .slider:before { transform: translateX(24px); }

</style>
</head>

<body>

<div class="container">

    <nav class="nav-top">
        <button class="btn-nav active" onclick="switchView('simples')" id="btn-simples">Vers√£o Simples</button>
        <button class="btn-nav" onclick="switchView('avancado')" id="btn-avancado">Vers√£o Avan√ßada (Comparativo)</button>
    </nav>

    <div id="view-simples" class="view-section active">
        <div class="box-simples">
            <div class="header-simples">
                <h2 style="margin:0; color:var(--primary-dark)">C√°lculo de Bonifica√ß√£o</h2>
                <small>Foco: C√°lculo "Por Dentro" e Valor L√≠quido</small>
            </div>

            <div style="margin-bottom: 15px;">
                <label>Regime Tribut√°rio</label>
                <select id="regimeSimples" onchange="calcularSimples()">
                    <option value="normal">Padr√£o (9,25% Ent/Sai)</option>
                    <option value="monofasico">Aliq Zero ou Monof√°sico (0%)</option>
                </select>
            </div>

            <label>Valor da mercadoria (R$)</label>
            <input type="number" id="valorSimples" step="0.01" placeholder="Ex: 100.00" oninput="calcularSimples()">

            <label>Margem de venda desejada (%)</label>
            <input type="number" id="margemSimples" step="0.01" placeholder="Ex: 25" oninput="calcularSimples()">

            <div style="margin-top: 25px;">
                <div class="linha">
                    <span>Pre√ßo de Venda:</span>
                    <span class="destaque-valor" id="s_precoVenda">R$ 0,00</span>
                </div>
                <div class="linha">
                    <span>(-) PIS/COFINS (Total):</span>
                    <span class="destaque-valor" id="s_totalPis">R$ 0,00</span>
                </div>
            </div>

            <div id="s_resumoFinanceiro" class="resumo-financeiro">
                <h3 style="margin:0 0 10px 0; font-size:1rem;">Resumo L√≠quido</h3>
                <div class="linha">
                    <span>(+) Receita Venda:</span>
                    <span id="s_resEntrada" style="color:blue">R$ 0,00</span>
                </div>
                <div class="linha">
                    <span>(-) Custo Mercadoria:</span>
                    <span id="s_resCusto" style="color:red">R$ 0,00</span>
                </div>
                <div class="linha">
                    <span>(-) Impostos:</span>
                    <span id="s_resImpostos" style="color:red">R$ 0,00</span>
                </div>
                <div class="linha" style="border-top:1px solid #ccc; padding-top:5px; font-weight:bold;">
                    <span>(=) Resultado L√≠quido:</span>
                    <span id="s_resLiquido">R$ 0,00</span>
                </div>
            </div>

            <div id="s_resultadoFinal" class="resultado-box" style="background:#eee;">Preencha os dados...</div>
            
            <div style="text-align: center; margin-top:10px; font-size: 0.9rem;" id="s_margemEfetiva"></div>

            <div class="alerta" id="s_bonificacaoExtra" style="display:none;"></div>
        </div>
    </div>

    <div id="view-avancado" class="view-section">
        
        <div class="toggle-mode">
            <span>Calcular Venda</span>
            <label class="switch">
                <input type="checkbox" id="modeSwitch" onchange="calcularAvancado()">
                <span class="slider"></span>
            </label>
            <span>Inverso (Achar Custo)</span>
            
            <select id="regimeAvancado" onchange="calcularAvancado()" style="width: auto; margin-left: 20px;">
                <option value="normal">Padr√£o (9,25%)</option>
                <option value="monofasico">Aliq Zero ou Monof√°sico (0%)</option>
            </select>
        </div>

        <div class="grid-comparativo">
            <div class="card-cenario">
                <div class="card-header">CEN√ÅRIO A (Base)</div>
                <div class="card-body">
                    <label id="lbl_A1">Custo (R$)</label>
                    <input type="number" id="inp_A1" value="100" oninput="calcularAvancado()">
                    
                    <label id="lbl_A2">Margem (%)</label>
                    <input type="number" id="inp_A2" value="30" oninput="calcularAvancado()">

                    <div class="kpi-row" style="margin-top:15px;">
                        <div class="kpi-card" id="kpiLucro_A">
                            <div class="kpi-label">Lucro</div>
                            <div class="kpi-value" id="resLucro_A">0,00</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-label">Margem</div>
                            <div class="kpi-value" id="resMargem_A">0%</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-label">Markup</div>
                            <div class="kpi-value" id="resMarkup_A">0x</div>
                        </div>
                    </div>

                    <div class="linha"><span>Venda Final:</span><span id="resVenda_A" style="font-weight:bold; color:var(--primary)">0,00</span></div>
                    <div class="linha"><span>Impostos:</span><span id="resImp_A" style="color:red">0,00</span></div>

                    <div class="chart-container">
                        <div class="donut-chart" id="chart_A"></div>
                    </div>
                </div>
            </div>

            <div class="card-cenario">
                <div class="card-header" style="background:#eff6ff; color:var(--primary)">CEN√ÅRIO B (Simula√ß√£o)</div>
                <div class="card-body">
                    <label id="lbl_B1">Custo (R$)</label>
                    <input type="number" id="inp_B1" value="95" oninput="calcularAvancado()">
                    
                    <label id="lbl_B2">Margem (%)</label>
                    <input type="number" id="inp_B2" value="30" oninput="calcularAvancado()">

                    <div class="kpi-row" style="margin-top:15px;">
                        <div class="kpi-card" id="kpiLucro_B">
                            <div class="kpi-label">Lucro</div>
                            <div class="kpi-value" id="resLucro_B">0,00</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-label">Margem</div>
                            <div class="kpi-value" id="resMargem_B">0%</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-label">Markup</div>
                            <div class="kpi-value" id="resMarkup_B">0x</div>
                        </div>
                    </div>

                    <div class="linha"><span>Venda Final:</span><span id="resVenda_B" style="font-weight:bold; color:var(--primary)">0,00</span></div>
                    <div class="linha"><span>Impostos:</span><span id="resImp_B" style="color:red">0,00</span></div>

                    <div class="chart-container">
                        <div class="donut-chart" id="chart_B"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
// ==================== L√ìGICA DE NAVEGA√á√ÉO ====================
function switchView(viewName) {
    // Esconde tudo
    document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.btn-nav').forEach(el => el.classList.remove('active'));

    // Mostra o selecionado
    document.getElementById('view-' + viewName).classList.add('active');
    document.getElementById('btn-' + viewName).classList.add('active');
}

// Formatador Global
const fmtMoney = (v) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

// ==================== L√ìGICA: VERS√ÉO SIMPLES ====================
function calcularSimples() {
    let custo = parseFloat(document.getElementById("valorSimples").value);
    let margem = parseFloat(document.getElementById("margemSimples").value);
    let regime = document.getElementById("regimeSimples").value;

    if (isNaN(custo) || isNaN(margem)) return;

    const aliquotaPadrao = 0.0925;
    let aliquotaSaida = (regime === 'monofasico') ? 0 : aliquotaPadrao;
    let aliquotaEntrada = aliquotaPadrao;

    // C√°lculos
    let precoVenda = custo * (1 + margem / 100);
    let pisRecebimento = custo * aliquotaEntrada;
    let pisVenda = precoVenda * aliquotaSaida;
    let totalPis = pisRecebimento + pisVenda;
    let lucro = precoVenda - custo - totalPis;
    let margemEfetiva = (lucro / precoVenda) * 100;

    // Bonifica√ß√£o por dentro
    let custoMaximo = precoVenda * (1 - margem/100 - aliquotaSaida);
    let bonificacaoExtra = custo - custoMaximo;

    // Atualiza DOM Simples
    document.getElementById("s_precoVenda").innerText = fmtMoney(precoVenda);
    document.getElementById("s_totalPis").innerText = fmtMoney(totalPis);

    document.getElementById("s_resEntrada").innerText = fmtMoney(precoVenda);
    document.getElementById("s_resCusto").innerText = fmtMoney(custo);
    document.getElementById("s_resImpostos").innerText = fmtMoney(totalPis);
    
    let elResLiq = document.getElementById("s_resLiquido");
    elResLiq.innerText = fmtMoney(lucro);
    elResLiq.style.color = lucro >= 0 ? "green" : "red";

    // Status Box
    let divResult = document.getElementById("s_resultadoFinal");
    if (lucro > 0) {
        divResult.innerText = "LUCRO: " + fmtMoney(lucro);
        divResult.style.background = "#dcfce7"; divResult.style.color = "#166534";
    } else {
        divResult.innerText = "PREJU√çZO: " + fmtMoney(lucro);
        divResult.style.background = "#fee2e2"; divResult.style.color = "#991b1b";
    }

    document.getElementById("s_margemEfetiva").innerHTML = "Margem Real: <b>" + margemEfetiva.toFixed(2) + "%</b>";

    // Alerta Bonifica√ß√£o
    let divAlert = document.getElementById("s_bonificacaoExtra");
    divAlert.style.display = "block";
    if (bonificacaoExtra > 0.05) { // Toler√¢ncia pequena
        divAlert.innerHTML = `üëâ Para manter a margem l√≠quida de ${margem}% (por dentro), pe√ßa mais <b>${fmtMoney(bonificacaoExtra)}</b> de bonifica√ß√£o.`;
        divAlert.style.borderLeftColor = "#2563eb";
        divAlert.style.background = "#eff6ff";
    } else {
        divAlert.innerHTML = "‚úî Bonifica√ß√£o suficiente para a margem desejada.";
        divAlert.style.borderLeftColor = "#16a34a";
        divAlert.style.background = "#dcfce7";
    }
}

// ==================== L√ìGICA: VERS√ÉO AVAN√áADA ====================
function calcularAvancado() {
    calcularCenarioAvancado('A');
    calcularCenarioAvancado('B');
}

function calcularCenarioAvancado(suffix) {
    const isReverse = document.getElementById("modeSwitch").checked;
    const regime = document.getElementById("regimeAvancado").value;
    
    let val1 = parseFloat(document.getElementById(`inp_${suffix}1`).value) || 0;
    let val2 = parseFloat(document.getElementById(`inp_${suffix}2`).value) || 0;

    // Labels Din√¢micos
    if(isReverse) {
        document.getElementById(`lbl_${suffix}1`).innerText = "Pre√ßo Venda (R$)";
        document.getElementById(`lbl_${suffix}2`).innerText = "Margem (%)";
    } else {
        document.getElementById(`lbl_${suffix}1`).innerText = "Custo (R$)";
        document.getElementById(`lbl_${suffix}2`).innerText = "Margem (%)";
    }

    let aliquotaSaida = (regime === 'monofasico') ? 0 : 0.0925;
    let aliquotaEntrada = 0.0925;
    
    let custo, venda;

    if (!isReverse) {
        custo = val1;
        venda = custo * (1 + val2 / 100);
    } else {
        venda = val1;
        custo = venda / (1 + val2 / 100);
    }

    let pisTot = (custo * aliquotaEntrada) + (venda * aliquotaSaida);
    let lucro = venda - custo - pisTot;
    let margemReal = (venda > 0) ? (lucro / venda) * 100 : 0;
    let markup = (custo > 0) ? (venda / custo) : 0;

    // Update DOM Avan√ßado
    document.getElementById(`resVenda_${suffix}`).innerText = fmtMoney(venda);
    document.getElementById(`resImp_${suffix}`).innerText = fmtMoney(pisTot);
    
    document.getElementById(`resLucro_${suffix}`).innerText = fmtMoney(lucro);
    document.getElementById(`kpiLucro_${suffix}`).style.color = lucro >= 0 ? "var(--success)" : "var(--danger)";
    
    document.getElementById(`resMargem_${suffix}`).innerText = margemReal.toFixed(1) + "%";
    document.getElementById(`resMarkup_${suffix}`).innerText = markup.toFixed(2) + "x";

    // Gr√°fico Donut
    if(venda > 0) {
        let pCusto = (custo / venda) * 100;
        let pImp = (pisTot / venda) * 100;
        let pLucro = (lucro / venda) * 100;
        if(pLucro < 0) { pLucro = 0; pCusto = 100 - pImp; }
        
        let stop1 = pCusto;
        let stop2 = pCusto + pImp;
        
        document.getElementById(`chart_${suffix}`).style.background = 
            `conic-gradient(#dc2626 0% ${stop1}%, #2563eb ${stop1}% ${stop2}%, #16a34a ${stop2}% 100%)`;
    }
}

// Inicializa√ß√£o
document.addEventListener("DOMContentLoaded", () => {
    calcularSimples();
    calcularAvancado();
});

</script>

</body>
</html>
