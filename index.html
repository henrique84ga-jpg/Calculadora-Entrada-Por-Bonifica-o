<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculadora Comercial Avan칞ada - Comparativo</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root {
    --primary: #2563eb;
    --primary-dark: #1e40af;
    --success: #16a34a;
    --warning: #ca8a04;
    --danger: #dc2626;
    --bg-page: #f8fafc;
    --bg-card: #ffffff;
    --text-main: #1e293b;
    --text-muted: #64748b;
    --border: #e2e8f0;
}

body {
    font-family: 'Inter', sans-serif;
    background: var(--bg-page);
    color: var(--text-main);
    padding: 0;
    margin: 0;
}

.container {
    max-width: 1200px;
    margin: 20px auto;
    padding: 0 15px;
}

header {
    text-align: center;
    margin-bottom: 30px;
}

h1 {
    font-size: 1.5rem;
    color: var(--primary-dark);
    margin: 0;
}

.controls {
    background: var(--bg-card);
    padding: 15px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    margin-bottom: 20px;
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: center;
    align-items: center;
}

.toggle-mode {
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 600;
    font-size: 0.9rem;
}

/* Switch Slider */
.switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 26px;
}
.switch input { opacity: 0; width: 0; height: 0; }
.slider {
    position: absolute;
    cursor: pointer;
    top: 0; left: 0; right: 0; bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 34px;
}
.slider:before {
    position: absolute;
    content: "";
    height: 18px; width: 18px;
    left: 4px; bottom: 4px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}
input:checked + .slider { background-color: var(--primary); }
input:checked + .slider:before { transform: translateX(24px); }

/* GRID LAYOUT COMPARATIVO */
.grid-comparativo {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

@media (max-width: 768px) {
    .grid-comparativo { grid-template-columns: 1fr; }
}

.card-cenario {
    background: var(--bg-card);
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    overflow: hidden;
    border: 1px solid var(--border);
}

.card-header {
    background: #f1f5f9;
    padding: 15px;
    font-weight: 700;
    text-align: center;
    color: var(--primary-dark);
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.card-body {
    padding: 20px;
}

/* INPUTS */
.input-group { margin-bottom: 15px; }
.input-group label {
    display: block;
    font-size: 0.85rem;
    font-weight: 600;
    margin-bottom: 5px;
    color: var(--text-muted);
}
.input-wrapper {
    position: relative;
}
.input-wrapper input, .input-wrapper select {
    width: 100%;
    padding: 12px;
    border: 1px solid #cbd5e1;
    border-radius: 8px;
    font-size: 1rem;
    font-family: inherit;
    box-sizing: border-box;
    transition: border-color 0.2s;
}
.input-wrapper input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

/* KPI CARDS (Destaques) */
.kpi-row {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 10px;
    margin-bottom: 20px;
}
.kpi-card {
    background: #f8fafc;
    padding: 10px;
    border-radius: 8px;
    text-align: center;
    border: 1px solid var(--border);
}
.kpi-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
.kpi-value { font-size: 1.1rem; font-weight: 800; color: var(--text-main); }
.kpi-sub { font-size: 0.7rem; color: var(--text-muted); margin-top: 2px;}

.lucro-positivo .kpi-value { color: var(--success); }
.lucro-negativo .kpi-value { color: var(--danger); }

/* LISTA DE RESULTADOS */
.resultado-lista {
    font-size: 0.9rem;
    margin-bottom: 20px;
}
.item-linha {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px dashed #e2e8f0;
}
.item-linha span:last-child { font-weight: 600; }
.text-danger { color: var(--danger); }
.text-primary { color: var(--primary); }

/* GR츼FICO DONUT CSS */
.chart-container {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid var(--border);
}
.donut-chart {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background: conic-gradient(
        #dc2626 0% 0%, 
        #2563eb 0% 0%, 
        #16a34a 0% 100%
    );
    position: relative;
}
/* Buraco do donut */
.donut-chart::after {
    content: "";
    position: absolute;
    width: 60px;
    height: 60px;
    background: var(--bg-card);
    border-radius: 50%;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
}
.chart-legend { font-size: 0.8rem; }
.legend-item { display: flex; align-items: center; gap: 5px; margin-bottom: 4px; }
.dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; }

/* BOT칏ES */
.btn-copy {
    width: 100%;
    padding: 12px;
    background: var(--text-main);
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: background 0.2s;
    margin-top: 10px;
}
.btn-copy:hover { background: #0f172a; }

/* AJUSTE PARA MODO INVERSO */
.hidden { display: none; }

</style>
</head>

<body>

<div class="container">
    <header>
        <h1>Calculadora Comercial & Bonifica칞칚o</h1>
        <p style="color: var(--text-muted); font-size: 0.9rem; margin-top: 5px;">Comparativo de Cen치rios e Margem por Dentro</p>
    </header>

    <div class="controls">
        <div class="toggle-mode">
            <span>Calcular Pre칞o de Venda</span>
            <label class="switch">
                <input type="checkbox" id="modeSwitch">
                <span class="slider"></span>
            </label>
            <span>Descobrir Custo M치ximo (Inverso)</span>
        </div>
        
        <div class="toggle-mode" style="margin-left: 20px;">
            <label style="font-size: 0.9rem; font-weight:600; margin-right:5px;">Regime:</label>
            <select id="regimeGlobal" style="padding: 5px; border-radius: 4px; border: 1px solid #ccc;">
                <option value="normal">Padr칚o (9,25%)</option>
                <option value="monofasico">Monof치sico (0% Sa칤da)</option>
            </select>
        </div>
    </div>

    <div class="grid-comparativo">
        
        <div class="card-cenario" id="cenarioA">
            <div class="card-header">
                CEN츼RIO A (Base)
            </div>
            <div class="card-body">
                <div class="input-group">
                    <label id="lblInput1_A">Custo da Mercadoria (R$)</label>
                    <div class="input-wrapper">
                        <input type="text" class="money-mask" id="input1_A" placeholder="0,00" value="100,00" oninput="formatCurrency(this)">
                    </div>
                </div>
                
                <div class="input-group">
                    <label id="lblInput2_A">Margem alvo sobre Custo (%)</label>
                    <div class="input-wrapper">
                        <input type="number" id="input2_A" placeholder="Ex: 30" value="30" step="0.1">
                    </div>
                    <small id="hint_A" style="color: #64748b; font-size: 0.75rem;">Define o Pre칞o de Venda</small>
                </div>

                <div class="kpi-row" id="kpi_A">
                    <div class="kpi-card" id="cardLucro_A">
                        <div class="kpi-label">Lucro L칤quido</div>
                        <div class="kpi-value" id="resLucro_A">R$ 0,00</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">Margem Real</div>
                        <div class="kpi-value" id="resMargem_A">0%</div>
                        <div class="kpi-sub">sobre a venda</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">Markup</div>
                        <div class="kpi-value" id="resMarkup_A">0.0x</div>
                    </div>
                </div>

                <div class="resultado-lista">
                    <div class="item-linha">
                        <span>Pre칞o de Venda Final</span>
                        <span class="text-primary" id="resVenda_A">R$ 0,00</span>
                    </div>
                    <div class="item-linha">
                        <span>(-) Custo Mercadoria</span>
                        <span class="text-danger" id="resCusto_A">R$ 0,00</span>
                    </div>
                    <div class="item-linha">
                        <span>(-) Impostos Totais</span>
                        <span class="text-danger" id="resImpostos_A">R$ 0,00</span>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="donut-chart" id="chart_A"></div>
                    <div class="chart-legend">
                        <div class="legend-item"><span class="dot" style="background:#dc2626"></span> Custo</div>
                        <div class="legend-item"><span class="dot" style="background:#2563eb"></span> Impostos</div>
                        <div class="legend-item"><span class="dot" style="background:#16a34a"></span> Lucro</div>
                    </div>
                </div>

                <button class="btn-copy" onclick="copiarResumo('A')">Copiar Resumo A</button>
            </div>
        </div>

        <div class="card-cenario" id="cenarioB">
            <div class="card-header" style="background: #eff6ff; color: var(--primary);">
                CEN츼RIO B (Simula칞칚o)
            </div>
            <div class="card-body">
                <div class="input-group">
                    <label id="lblInput1_B">Custo da Mercadoria (R$)</label>
                    <div class="input-wrapper">
                        <input type="text" class="money-mask" id="input1_B" placeholder="0,00" value="95,00" oninput="formatCurrency(this)">
                    </div>
                </div>
                
                <div class="input-group">
                    <label id="lblInput2_B">Margem alvo sobre Custo (%)</label>
                    <div class="input-wrapper">
                        <input type="number" id="input2_B" placeholder="Ex: 30" value="30" step="0.1">
                    </div>
                    <small id="hint_B" style="color: #64748b; font-size: 0.75rem;">Define o Pre칞o de Venda</small>
                </div>

                <div class="kpi-row" id="kpi_B">
                    <div class="kpi-card" id="cardLucro_B">
                        <div class="kpi-label">Lucro L칤quido</div>
                        <div class="kpi-value" id="resLucro_B">R$ 0,00</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">Margem Real</div>
                        <div class="kpi-value" id="resMargem_B">0%</div>
                        <div class="kpi-sub">sobre a venda</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">Markup</div>
                        <div class="kpi-value" id="resMarkup_B">0.0x</div>
                    </div>
                </div>

                <div class="resultado-lista">
                    <div class="item-linha">
                        <span>Pre칞o de Venda Final</span>
                        <span class="text-primary" id="resVenda_B">R$ 0,00</span>
                    </div>
                    <div class="item-linha">
                        <span>(-) Custo Mercadoria</span>
                        <span class="text-danger" id="resCusto_B">R$ 0,00</span>
                    </div>
                    <div class="item-linha">
                        <span>(-) Impostos Totais</span>
                        <span class="text-danger" id="resImpostos_B">R$ 0,00</span>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="donut-chart" id="chart_B"></div>
                    <div class="chart-legend">
                        <div class="legend-item"><span class="dot" style="background:#dc2626"></span> Custo</div>
                        <div class="legend-item"><span class="dot" style="background:#2563eb"></span> Impostos</div>
                        <div class="legend-item"><span class="dot" style="background:#16a34a"></span> Lucro</div>
                    </div>
                </div>

                <button class="btn-copy" onclick="copiarResumo('B')">Copiar Resumo B</button>
            </div>
        </div>

    </div>
</div>

<script>
// ==================== UTILIT츼RIOS ====================

// Formata input para moeda R$ (Item 6)
function formatCurrency(input) {
    let value = input.value.replace(/\D/g, "");
    value = (value / 100).toFixed(2) + "";
    value = value.replace(".", ",");
    value = value.replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1.");
    input.value = value;
    calcularGeral(); // Recalcula ao digitar
}

// Converte string "1.000,00" para float JS
function parseMoney(str) {
    if(!str) return 0;
    return parseFloat(str.replace(/\./g, "").replace(",", ".")) || 0;
}

// Formata float para display
function toMoney(val) {
    return val.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
}

// ==================== L칍GICA DE C츼LCULO ====================

const ALIQUOTA_PADRAO = 0.0925; // 9.25%

// Fun칞칚o principal que orquestra A e B
function calcularGeral() {
    calcularCenario('A');
    calcularCenario('B');
}

function calcularCenario(suffix) {
    // 1. Coleta Inputs
    const isReverseMode = document.getElementById("modeSwitch").checked;
    const regime = document.getElementById("regimeGlobal").value;
    
    // Inputs variam dependendo do modo
    let val1 = parseMoney(document.getElementById(`input1_${suffix}`).value); // Custo ou Pre칞o
    let val2 = parseFloat(document.getElementById(`input2_${suffix}`).value); // Margem ou Margem
    
    if (isNaN(val1)) val1 = 0;
    if (isNaN(val2)) val2 = 0;

    // Configura Labels Dinamicamente
    if (isReverseMode) {
        document.getElementById(`lblInput1_${suffix}`).innerText = "Pre칞o de Venda Desejado (R$)";
        document.getElementById(`lblInput2_${suffix}`).innerText = "Margem Desejada (%)";
        document.getElementById(`hint_${suffix}`).innerText = "Define o Custo M치ximo permitido";
    } else {
        document.getElementById(`lblInput1_${suffix}`).innerText = "Custo da Mercadoria (R$)";
        document.getElementById(`lblInput2_${suffix}`).innerText = "Margem sobre Custo (Markup %)";
        document.getElementById(`hint_${suffix}`).innerText = "Define o Pre칞o de Venda";
    }

    // Configura Al칤quotas
    let aliquotaSaida = (regime === 'monofasico') ? 0 : ALIQUOTA_PADRAO;
    let aliquotaEntrada = ALIQUOTA_PADRAO;

    // Vari치veis de Sa칤da
    let custo, precoVenda, margemPct;

    // 2. Realiza o c치lculo (Normal ou Inverso)
    if (!isReverseMode) {
        // MODO PADR츾O: Tenho Custo + Margem -> Quero Pre칞o
        // Usu치rio pediu para manter c치lculo original: Pre칞o = Custo * (1 + Margem/100)
        custo = val1;
        let margemInput = val2;
        precoVenda = custo * (1 + margemInput / 100);
    } else {
        // MODO INVERSO (Item 2): Tenho Pre칞o + Margem -> Quero Custo M치ximo
        // Invertendo a f칩rmula: Custo = Pre칞o / (1 + Margem/100)
        precoVenda = val1;
        let margemInput = val2;
        custo = precoVenda / (1 + margemInput / 100);
    }

    // 3. Calcula Impostos e Lucro
    // Nota: Imposto de entrada 칠 cr칠dito (reduz custo efetivo contabilmente),
    // mas na l칩gica de fluxo de caixa simples pedido:
    // PIS Recebimento = Custo * 9.25%
    // PIS Venda = Venda * 9.25% (ou 0)
    
    let pisRecebimento = custo * aliquotaEntrada; 
    let pisVenda = precoVenda * aliquotaSaida;
    let totalPis = pisRecebimento + pisVenda; // Total a pagar de impostos somados

    let lucro = precoVenda - custo - totalPis;
    let margemEfetiva = (precoVenda > 0) ? (lucro / precoVenda) * 100 : 0;
    let markup = (custo > 0) ? (precoVenda / custo) : 0;

    // 4. Atualiza UI (DOM)
    document.getElementById(`resVenda_${suffix}`).innerText = toMoney(precoVenda);
    document.getElementById(`resCusto_${suffix}`).innerText = toMoney(custo);
    document.getElementById(`resImpostos_${suffix}`).innerText = toMoney(totalPis);
    
    document.getElementById(`resLucro_${suffix}`).innerText = toMoney(lucro);
    document.getElementById(`resMargem_${suffix}`).innerText = margemEfetiva.toFixed(2) + "%";
    document.getElementById(`resMarkup_${suffix}`).innerText = markup.toFixed(2) + "x";

    // Estilo condicional do lucro
    const cardLucro = document.getElementById(`cardLucro_${suffix}`);
    if(lucro >= 0) {
        cardLucro.className = "kpi-card lucro-positivo";
    } else {
        cardLucro.className = "kpi-card lucro-negativo";
    }

    // 5. Atualiza Gr치fico (Item 5) - Donut com Conic Gradient
    if (precoVenda > 0) {
        // Normaliza percentuais para o gr치fico
        // Custo % no gr치fico deve ser visualmente Custo / Venda
        let pCusto = (custo / precoVenda) * 100;
        let pImp = (totalPis / precoVenda) * 100;
        let pLucro = (lucro / precoVenda) * 100;

        // Se lucro negativo, o gr치fico quebra, ent칚o travamos visualmente
        if (pLucro < 0) { pLucro = 0; pCusto = 100 - pImp; }

        // Pontos de parada do gradiente
        let stop1 = pCusto; 
        let stop2 = pCusto + pImp;

        const chart = document.getElementById(`chart_${suffix}`);
        // Vermelho (Custo), Azul (Imposto), Verde (Lucro)
        chart.style.background = `conic-gradient(
            #dc2626 0% ${stop1}%, 
            #2563eb ${stop1}% ${stop2}%, 
            #16a34a ${stop2}% 100%
        )`;
    }
}

// ==================== FUN칂츾O COPIAR (Item 3) ====================
function copiarResumo(suffix) {
    const venda = document.getElementById(`resVenda_${suffix}`).innerText;
    const custo = document.getElementById(`resCusto_${suffix}`).innerText;
    const lucro = document.getElementById(`resLucro_${suffix}`).innerText;
    const margem = document.getElementById(`resMargem_${suffix}`).innerText;
    
    const texto = `游늵 *Resumo Calculadora (${suffix})*\n\n` +
                  `游눯 Venda: ${venda}\n` +
                  `游닍 Custo: ${custo}\n` +
                  `游늳 Margem: ${margem}\n` +
                  `游눳 Lucro Liq: ${lucro}`;

    navigator.clipboard.writeText(texto).then(() => {
        alert("Resumo copiado para a 치rea de transfer칡ncia!");
    });
}

// ==================== EVENT LISTENERS ====================
document.addEventListener("DOMContentLoaded", () => {
    // Formata valores iniciais
    formatCurrency(document.getElementById("input1_A"));
    formatCurrency(document.getElementById("input1_B"));
    
    // Listeners gerais
    document.getElementById("modeSwitch").addEventListener("change", calcularGeral);
    document.getElementById("regimeGlobal").addEventListener("change", calcularGeral);
    
    // Inputs A
    document.getElementById("input1_A").addEventListener("input", () => calcularCenario('A')); // formatCurrency j치 chama calcular
    document.getElementById("input2_A").addEventListener("input", () => calcularCenario('A'));
    
    // Inputs B
    document.getElementById("input1_B").addEventListener("input", () => calcularCenario('B'));
    document.getElementById("input2_B").addEventListener("input", () => calcularCenario('B'));

    // C치lculo inicial
    calcularGeral();
});

</script>

</body>
</html>
