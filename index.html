<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculadora Bonifica√ß√£o ‚Äì Margem por Dentro</title>

<style>
:root {
    --primary-color: #2c3e50;
    --accent-color: #3498db;
    --bg-color: #f0f2f5;
    --card-bg: #ffffff;
    --success-bg: #d4edda;
    --success-text: #155724;
    --warning-bg: #fff3cd;
    --warning-text: #856404;
    --danger-bg: #f8d7da;
    --danger-text: #721c24;
}

body {
    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    background: var(--bg-color);
    padding: 20px;
    margin: 0;
    color: #333;
}

.box {
    max-width: 600px;
    background: var(--card-bg);
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    margin: auto;
}

h2 {
    text-align: center;
    color: var(--primary-color);
    margin-bottom: 25px;
    font-size: 1.5rem;
    border-bottom: 2px solid #eee;
    padding-bottom: 15px;
}

.form-group {
    margin-bottom: 15px;
}

label {
    font-weight: 600;
    margin-bottom: 6px;
    display: block;
    color: var(--primary-color);
}

input, select {
    width: 100%;
    padding: 12px;
    margin-top: 5px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 16px;
    box-sizing: border-box;
    transition: border-color 0.3s;
}

input:focus, select:focus {
    border-color: var(--accent-color);
    outline: none;
}

.linha {
    margin-top: 10px;
    font-size: 14px;
    display: flex;
    justify-content: space-between;
    padding: 5px 0;
    border-bottom: 1px dashed #eee;
}

.destaque-valor {
    font-weight: bold;
}

.resultado-container {
    margin-top: 25px;
    border-top: 2px solid #eee;
    padding-top: 20px;
}

.resultado {
    padding: 15px;
    border-radius: 8px;
    font-weight: bold;
    text-align: center;
    font-size: 1.1rem;
    margin-bottom: 10px;
    box-shadow: inset 0 0 5px rgba(0,0,0,0.05);
}

.lucro { background: var(--success-bg); color: var(--success-text); border: 1px solid #c3e6cb; }
.empate { background: var(--warning-bg); color: var(--warning-text); border: 1px solid #ffeeba; }
.prejuizo { background: var(--danger-bg); color: var(--danger-text); border: 1px solid #f5c6cb; }

.alerta {
    margin-top: 20px;
    padding: 15px;
    background: #e8f4fd;
    border-left: 5px solid var(--accent-color);
    font-size: 14px;
    line-height: 1.5;
    border-radius: 4px;
}

.resumo-financeiro {
    background-color: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    margin-top: 20px;
    border: 1px solid #e9ecef;
}

.resumo-financeiro h3 {
    margin-top: 0;
    font-size: 16px;
    color: #555;
    margin-bottom: 10px;
}

small {
    color: #777;
    font-weight: normal;
}
</style>
</head>

<body>

<div class="box">
    <h2>Calculadora de Bonifica√ß√£o</h2>

    <div class="form-group">
        <label>Regime Tribut√°rio (PIS/COFINS)</label>
        <select id="regime">
            <option value="normal">Padr√£o (9,25% na entrada e sa√≠da)</option>
            <option value="monofasico">Monof√°sico / Al√≠quota Zero (Sem d√©bito na sa√≠da)</option>
        </select>
    </div>

    <div class="form-group">
        <label>Valor da mercadoria (base cont√°bil)</label>
        <input type="number" id="valor" step="0.01" placeholder="Ex: 100.00">
    </div>

    <div class="form-group">
        <label>Margem de venda desejada (%)</label>
        <input type="number" id="margemDesejada" step="0.01" placeholder="Ex: 25">
    </div>

    <div class="resultado-container">
        <div class="linha">
            <span>Pre√ßo de venda sugerido:</span>
            <span class="destaque-valor" id="precoVenda">R$ 0,00</span>
        </div>
        
        <div class="linha" style="color: #d63384;">
            <span>(-) PIS/COFINS Entrada (Sobre a Bonifica√ß√£o):</span>
            <span class="destaque-valor" id="pisRecebimento">R$ 0,00</span>
        </div>
        
        <div class="linha" style="color: #d63384;">
            <span>(-) PIS/COFINS Sa√≠da (Venda):</span>
            <span class="destaque-valor" id="pisVenda">R$ 0,00</span>
        </div>
        
        <div class="linha" style="font-weight: bold;">
            <span>(=) Total de Impostos:</span>
            <span class="destaque-valor" id="totalPis">R$ 0,00</span>
        </div>
    </div>

    <div id="resumoFinanceiro" class="resumo-financeiro" style="display:none;">
        <h3>Resumo L√≠quido (Conta Final)</h3>
        <div class="linha">
            <span>(+) Entrada (Venda):</span>
            <span id="resumoEntrada">R$ 0,00</span>
        </div>
        <div class="linha">
            <span>(-) Custo Mercadoria:</span>
            <span id="resumoCusto">R$ 0,00</span>
        </div>
        <div class="linha">
            <span>(-) Impostos Totais:</span>
            <span id="resumoImpostos">R$ 0,00</span>
        </div>
        <div class="linha" style="border-top: 1px solid #ccc; margin-top:5px; padding-top:5px;">
            <span style="font-weight:bold;">(=) Resultado L√≠quido:</span>
            <span id="resumoLiquido" style="font-weight:bold;">R$ 0,00</span>
        </div>
    </div>

    <div id="resultadoFinal" class="resultado"></div>
    <div style="text-align: center; font-size: 14px; color: #555;" id="margemEfetiva"></div>

    <div class="alerta" id="bonificacaoExtra" style="display:none;"></div>

</div>

<script>
function calcular() {
    let custo = parseFloat(document.getElementById("valor").value);
    let margem = parseFloat(document.getElementById("margemDesejada").value);
    let regime = document.getElementById("regime").value;

    // Elementos de UI
    let divResultado = document.getElementById("resultadoFinal");
    let divAlerta = document.getElementById("bonificacaoExtra");
    let divResumo = document.getElementById("resumoFinanceiro");

    if (isNaN(custo) || isNaN(margem)) {
        divResultado.innerHTML = "Preencha os valores...";
        divResultado.className = "resultado";
        divResultado.style.background = "#eee";
        divResultado.style.color = "#555";
        divAlerta.style.display = "none";
        divResumo.style.display = "none";
        return;
    }

    const aliquotaPadrao = 0.0925;
    
    // Define a al√≠quota de SA√çDA baseada na sele√ß√£o
    let aliquotaSaida = (regime === 'monofasico') ? 0 : aliquotaPadrao;
    
    // A al√≠quota de ENTRADA (sobre a bonifica√ß√£o recebida) permanece, 
    // pois o usu√°rio disse "somente haver√° a receita na entrada"
    let aliquotaEntrada = aliquotaPadrao; 

    // 1. Pre√ßo de venda com margem desejada
    let precoVenda = custo * (1 + margem / 100);

    // 2. PIS/COFINS
    let pisRecebimento = custo * aliquotaEntrada; // Tributo gerado pela entrada da bonifica√ß√£o
    let pisVenda = precoVenda * aliquotaSaida;    // Tributo gerado pela venda (0 se monof√°sico)
    let totalPis = pisRecebimento + pisVenda;

    // 3. Lucro real (Valor L√≠quido)
    let lucro = precoVenda - custo - totalPis;

    // 4. Margem efetiva final
    let margemEfetiva = (lucro / precoVenda) * 100;

    // ===== C√ÅLCULO POR DENTRO (Bonifica√ß√£o Necess√°ria) =====
    // F√≥rmula ajustada para considerar a al√≠quota de sa√≠da din√¢mica
    // CustoMaximo = Valor que sobra do Pre√ßo de Venda ap√≥s tirar a Margem Desejada e os Impostos de Sa√≠da
    // Nota: O c√°lculo original simplificado n√£o considerava o efeito circular do imposto de entrada
    // mas mantive a l√≥gica de "Quanto o custo precisa baixar".
    
    // Se for monof√°sico, o "custo m√°ximo" aumenta pois paga-se menos imposto na sa√≠da
    let custoMaximo = precoVenda * (1 - margem/100 - aliquotaSaida);
    let bonificacaoExtra = custo - custoMaximo;

    // ===== EXIBI√á√ÉO =====

    // Atualiza valores monet√°rios
    const fmt = (v) => "R$ " + v.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    
    document.getElementById("precoVenda").innerText = fmt(precoVenda);
    document.getElementById("pisRecebimento").innerText = fmt(pisRecebimento);
    document.getElementById("pisVenda").innerText = fmt(pisVenda) + (regime === 'monofasico' ? " (Isento)" : "");
    document.getElementById("totalPis").innerText = fmt(totalPis);

    // Resumo Financeiro (Conta de Chegada)
    divResumo.style.display = "block";
    document.getElementById("resumoEntrada").innerText = fmt(precoVenda);
    document.getElementById("resumoEntrada").style.color = "blue";
    
    document.getElementById("resumoCusto").innerText = fmt(custo);
    document.getElementById("resumoCusto").style.color = "red";
    
    document.getElementById("resumoImpostos").innerText = fmt(totalPis);
    document.getElementById("resumoImpostos").style.color = "red";
    
    let elResumoLiquido = document.getElementById("resumoLiquido");
    elResumoLiquido.innerText = fmt(lucro);
    
    // Estiliza√ß√£o do Resultado Principal
    if (lucro > 0) {
        divResultado.className = "resultado lucro";
        divResultado.innerHTML = "LUCRO REAL: " + fmt(lucro);
        elResumoLiquido.style.color = "#155724";
    } else if (Math.abs(lucro) < 0.01) { // Trata flutua√ß√£o de ponto flutuante perto de zero
        divResultado.className = "resultado empate";
        divResultado.innerHTML = "EMPATE (0,00)";
        elResumoLiquido.style.color = "#856404";
    } else {
        divResultado.className = "resultado prejuizo";
        divResultado.innerHTML = "PREJU√çZO: " + fmt(lucro);
        elResumoLiquido.style.color = "#721c24";
    }

    document.getElementById("margemEfetiva").innerHTML = 
        "Margem efetiva final: <b>" + margemEfetiva.toFixed(2) + "%</b>";

    // L√≥gica do Alerta de Bonifica√ß√£o Extra
    divAlerta.style.display = "block";
    if (bonificacaoExtra > 0) {
        divAlerta.innerHTML = 
            "üëâ Para garantir a margem l√≠quida de " + margem.toFixed(2) + 
            "%, considerando os impostos atuais, voc√™ precisaria de mais <b>" + fmt(bonificacaoExtra) + 
            "</b> em bonifica√ß√£o (redu√ß√£o de custo).";
        divAlerta.style.borderColor = "#1f4e8c";
        divAlerta.style.background = "#eef3ff";
    } else {
        divAlerta.innerHTML = "‚úî A bonifica√ß√£o/custo atual √© suficiente para a margem desejada.";
        divAlerta.style.borderColor = "#28a745";
        divAlerta.style.background = "#e0f5e6";
    }
}

// Event Listeners
document.getElementById("valor").addEventListener("input", calcular);
document.getElementById("margemDesejada").addEventListener("input", calcular);
document.getElementById("regime").addEventListener("change", calcular);
</script>

</body>
</html>
